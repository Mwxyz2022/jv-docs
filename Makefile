SHELL = /bin/bash

JEKYLL_BIN = bundle exec jekyll
BASEURL_PATH = /jv-docs


.PHONY: all help install clean build serve dev rebuild check
.PHONY: install clean build serve dev rebuild check

all: help

# --------------------------------------------------------------------------------------
# Довідка
# --------------------------------------------------------------------------------------
help:
	@echo "Використання:"
	@echo "  make install     - Встановлює/оновлює всі необхідні геми (bundle install)."
	@echo "  make clean       - Видаляє згенеровану папку _site/ та кеш Jekyll."
	@echo "  make build       - Збирає статичний сайт у папку _site/."
	@echo "  make serve       - Запускає локальний сервер для розробки (доступно на http://127.0.0.1:4000$(BASEURL_PATH)/)."
	@echo "  make dev         - Очищає і запускає локальний сервер (зручно для швидкого старту)."
	@echo "  make rebuild     - Очищає і перебудовує сайт (корисно після змін в _config.yml)."
	@echo "  make check       - Перевіряє синтаксис ваших файлів Jekyll."

# --------------------------------------------------------------------------------------
# Команди управління залежностями
# --------------------------------------------------------------------------------------
install:
	@echo "--- Встановлення / оновлення Ruby Gems ---"
	bundle install
	@echo "--- Ruby Gems встановлено. ---"

# --------------------------------------------------------------------------------------
# Команди збірки
# --------------------------------------------------------------------------------------
clean:
	@echo "--- Видалення згенерованих файлів (_site/ та кеш Jekyll) ---"
	rm -rf _site/
	rm -rf .jekyll-cache/
	@echo "--- Файли видалено. ---"

build: clean
	@echo "--- Збірка Jekyll-сайту... ---"
	$(JEKYLL_BIN) build
	@echo "--- Збірку завершено. Сайт у _site/ ---"

serve:
	@echo "--- Запуск локального Jekyll-сервера... ---"
	@echo "   Документація буде доступна за адресою: http://127.0.0.1:4000$(BASEURL_PATH)/"
	@echo "   Натисніть Ctrl+C, щоб зупинити сервер."
	$(JEKYLL_BIN) serve --force_polling # --force_polling допомагає з відстеженням змін на деяких файлових системах
	@echo "--- Сервер зупинено. ---"

dev: clean serve
	@echo "--- Очистка, збірка та запуск розробницького сервера завершені. ---"

rebuild: clean build
	@echo "--- Очистка та повна перебудова сайту завершені. ---"

# --------------------------------------------------------------------------------------
# Команди перевірки (може знадобитись для відладки)
# --------------------------------------------------------------------------------------
check:
	@echo "--- Перевірка синтаксису Jekyll та YAML ---"
	$(JEKYLL_BIN) doctor
	@echo "--- Перевірка завершена. Дивіться вихідні повідомлення. ---"